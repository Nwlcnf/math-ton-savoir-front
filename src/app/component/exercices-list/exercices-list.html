<!-- Loader -->
@if (loading) {
    <div class="loading-container" role="status" aria-live="polite">
        <mat-progress-spinner mode="indeterminate" diameter="50" color="primary"></mat-progress-spinner>
        <p>Chargement des exercices...</p>
    </div>
} @else {

    <!-- Barre de recherche -->
    <div class="search-bar">
        <span class="icon material-icons">search</span>
        <input
                type="text"
                placeholder="Rechercher un exercice..."
                [(ngModel)]="searchTerm"
                (input)="applyFilters()" />
    </div>

    <!-- Filtres -->
    <div class="filters">
        <div class="filter-group">
            <span class="filter-label">Type :</span>
            @for (type of types; track $index) {
                <button (click)="toggleFilter('typeExercice', type)" [class.selected]="selectedType === type">
                    {{ type }}
                </button>
            }
        </div>

        <div class="filter-group">
            <span class="filter-label">DifficultÃ© :</span>
            @for (diff of difficultes; track $index) {
                <button (click)="toggleFilter('difficulte', diff)" [class.selected]="selectedDifficulte === diff">
                    {{ diff }}
                </button>
            }
        </div>
    </div>

    <!-- Bouton reset -->
    <div class="filters-reset">
        <button (click)="resetFilters()">RÃ©initialiser</button>
    </div>

    <!-- Liste -->
    @if (filteredExercices.length > 0) {
        <div class="exercices-list">
            @for (ex of filteredExercices; track $index) {
                <div class="exercice-card" tabindex="0">

                    <!-- Ligne badges -->
                    <div class="badge-row">
                        <span class="badge type">{{ ex.typeExercice }}</span>
                        <span class="badge diff diff-{{ ex.difficulte | lowercase }}">{{ ex.difficulte }}</span>
                    </div>

                    <!-- Titre -->
                    <h3 class="exercice-title">{{ ex.enonceExercice }}</h3>

                    <!-- Infos leÃ§on -->
                    <p class="lesson-ref">ðŸ“š {{ ex.lecon?.nomLecon || 'LeÃ§on inconnue' }}</p>
                    <p class="chapter-ref">Chapitre : {{ ex.lecon?.chapitre?.nomChapitre || 'Chapitre inconnu' }}</p>

                    <!-- Bouton -->
                    <button class="btn-start" (click)="startExercice(ex.idExercice)">
                        ðŸš€ DÃ©marrer
                    </button>
                </div>
            }
        </div>
    } @else {
        <p class="no-result">Aucun exercice trouvÃ©.</p>
    }
}
